\documentclass{scrartcl}

\usepackage{brian}

\begin{document}
\begin{lemma}[ultrafilter lemma]\label{lem:ultra}
  Let $S$ be a set. Every filter on $S$ is contained in an ultrafilter. 
\end{lemma}
\begin{cor}[nonprincipal ultrafilter]
  For any infinite set $S$, there is an ultrafilter $U$ on $S$ that is not generated by a singleton. Such a $U$ is nonprincipal. 
\end{cor}
\begin{proof}
  Consider the cofinite filter on $S$:
  \[
  F=\{X\subseteq S: |X|\geq \aleph_0\}
  \]
  Then $F$ is contained in a nonprincipal ultrafilter. 
\end{proof}
\begin{defn}[ultrapower]
  Suppose $M_i$ is a model over language $\mathcal L$ for each $i\in I$. Let $U$ be a nonprincipal ultrafilter on $I$. Consider
  \[
  \prod M_i / U
  \]
  where quotienting by $U$ is understood to mean quotienting by the equivalence relation $\sim$ where
  \[
  (x_i)_{i\in I} = (y_i)_{i\in I}
  \]
  iff the set of indices $i$ such that $x_i = y_i$ is in $U$. (Equality by vote).
  
  We can make $\prod M_i / U$ into a model over $\mathcal L$. Interpret the constant symbol $c$ as the equivalence class of
  \[
  (c|_{M_i})_{i\in I}
  \]
  with $c|_{M_i}$ indicating interpretation (of $c$) in $M_i$. 
  
  Similarly, interpret the function $f(x)$ by
  \[
  f\bigl( (x_i)_{i\in I} \bigr) = \left[\bigl( f(x_i)|_{M_i}\bigr)\right]
  \]
  where $[-]$ denotes `equivalence class of'. 
  
  Finally, interpret the predicate $\phi(x)$ by 
  \[
  \phi\bigl((x_i)_{i\in I}\bigr) \iff \{i\in I: \phi(x_i)\} \in U
  \]
  which is truth by vote. Because $U$ is an ultrafilter, the law of the excluded middle will in fact hold as either 
  \[
  \{i\in I: p|_i\textrm{ holds}\} \in U
  \]
  or 
  \[
  \{i\in I: (\neg p)|_i\textrm{ holds}\} = U-   \{i\in I: p|_i\textrm{ holds}\} \in U\in U
  \]
\end{defn}

\begin{theorem}[compactness theorem]\label{th:compactness}
  If every finite subtheory of $\Phi$ has a model, then $\Phi$ has a model. 
\end{theorem}
\begin{proof}
  \newcommand{\finof}{\texttt{fin}}
  Let $\finof(\Phi)$ be the set of finite subtheories of $\Phi$. By assumption, for each $F\in\finof(\Phi)$, there is a model $M_F$ of $F$. 
For appropriate choice of utlrafilter $U$ on $\finof(\Phi)$, I claim
\[
\prod_{F\in\finof(\Phi)} M_F/U
\]
models $\Phi$. To see this, pick an arbitrary $\phi \in \Phi$. Define
\[
H_\phi = \{F\subseteq \finof(\Phi): M_F \models \phi\} 
\]
to be the set of models where $\phi$ holds.
Consider
\[
F = \{ H_\phi : \phi \in \Phi\}
\]
Then $F$ is a filter on $\finof(\Phi)$. By the \nameref{lem:ultra}, $F$ is contained in some ultrafilter $U$. Hence
we have chosen a $U$ such that, for each $\phi \in \Phi$, the set $\{f\in \finof(\Phi): M_f\models \phi\}$ is in $U$. Then
\[
\prod_{F\in\finof(\Phi)} M_F/U \models \Phi
\]
\end{proof}
\begin{cor}
  The \nameref{lem:ultra} implies the \nameref{th:compactness}. 
\end{cor}
The converse is also true: 
\begin{theorem}
  The \nameref{th:compactness} implies \nameref{lem:ultra}. 
\end{theorem}
\begin{proof}
  \newcommand{\setth}{\texttt{set}}
  Suppose $F$ is a filter on $S$. We can encode this assertion in a theory. Let $\mathcal L$ be the language of set theory with constant symbols $S$ and $F$. Let $\setth$ be the axioms of set theory. To encode the statement $F$ is a filter on $S$, define the theory 
  \begin{align*}
  \Phi = \setth \cup &\bigl\{  \\
    & S \in F, \\
    & \forall A,B ( A\in F \wedge B \in S \implies A \cap B \in F ), \\
    &\varnothing \notin F, \\ 
    &\forall A,B(A\in F \wedge A \subseteq B \implies B \in F) \\
    &\bigr\}
  \end{align*}
  Then $\Phi$ has a model iff we can find a filter $F$ on $S$. Define the language $\mathcal L'$ by adding a constant symbol
  $x_s$ for each $s\subseteq S$. Now define the theory $\Phi'$ over $\mathcal L'$ by
  \begin{align*}
    \Phi' = \Phi&\cup \{x_s \subseteq S : s\subseteq S \} \\
    &\cup \{x_s \in F \vee S-x_s \in F : s \subseteq S\}
  \end{align*}
  By \nameref{th:compactness}, $\Phi'$ has a model $M$. This $M$ has a copy of $S$ and $U$. They may contain extra elements, but 
  \[
  \{X\cap S : X\subseteq U\} - \varnothing
  \]
  gives an ultrafilter on $S$ containing $F$. 
\end{proof}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
