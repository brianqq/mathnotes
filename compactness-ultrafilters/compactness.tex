\documentclass{scrartcl}

\usepackage{brian}

\begin{document}
\renewcommand{\proofSymbol}{\textrm{\fontspec{NotoEmoji-Regular}üëç}}
\begin{lemma}[ultrafilter lemma]\label{lem:ultra}
  Let $S$ be a set. Every filter on $S$ is contained in an ultrafilter. 
\end{lemma}
\begin{cor}[nonprincipal ultrafilter]
  For any infinite set $S$, there is an ultrafilter $U$ on $S$ that is not generated by a singleton. Such a $U$ is nonprincipal. 
\end{cor}
\begin{proof}
  Consider the cofinite filter on $S$:
  \[
  F=\{X\subseteq S: |X|\geq \aleph_0\}
  \]
  Then $F$ is contained in a nonprincipal ultrafilter. 
\end{proof}
\begin{defn}[ultrapower]
  Suppose $M_i$ is a model over language $\mathcal L$ for each $i\in I$. Let $U$ be a nonprincipal ultrafilter on $I$. Consider
  \[
  \prod M_i / U
  \]
  where quotienting by $U$ is understood to mean quotienting by the equivalence relation $\sim$ where
  \[
  (x_i)_{i\in I} = (y_i)_{i\in I}
  \]
  iff the set of indices $i$ such that $x_i = y_i$ is in $U$. (Equality by vote).
  
  We can make $\prod M_i / U$ into a model over $\mathcal L$. Interpret the constant symbol $c$ as the equivalence class of
  \[
  (c|_{M_i})_{i\in I}
  \]
  with $c|_{M_i}$ indicating interpretation (of $c$) in $M_i$. 
  
  Similarly, interpret the function $f(x)$ by
  \[
  f\bigl( (x_i)_{i\in I} \bigr) = \left[\bigl( f(x_i)|_{M_i}\bigr)\right]
  \]
  where $[-]$ denotes `equivalence class of'. 
  
  Finally, interpret the predicate $\phi(x)$ by 
  \[
  \phi\bigl((x_i)_{i\in I}\bigr) \iff \{i\in I: \phi(x_i)\} \in U
  \]
  which is truth by vote. Because $U$ is an ultrafilter, the law of the excluded middle will in fact hold as either 
  \[
  \{i\in I: p|_i\textrm{ holds}\} \in U
  \]
  or 
  \[
  \{i\in I: (\neg p)|_i\textrm{ holds}\} = U-   \{i\in I: p|_i\textrm{ holds}\} \in U\in U
  \]
\end{defn}

\begin{theorem}[compactness theorem]\label{th:compactness}
  If every finite subtheory of $\Phi$ has a model, then $\Phi$ has a model. 
\end{theorem}
\begin{proof}
  \newcommand{\finof}{\texttt{fin}}
  Let $\finof(\Phi)$ be the set of finite subtheories of $\Phi$. By assumption, for each $F\in\finof(\Phi)$, there is a model $M_F$ of $F$. 
For appropriate choice of utlrafilter $U$ on $\finof(\Phi)$, I claim
\[
\prod_{F\in\finof(\Phi)} M_F/U
\]
models $\Phi$. To see this, pick an arbitrary $\phi \in \Phi$. Define
\[
H_\phi = \{f\subseteq \finof(\Phi): M_f \models \phi\} 
\]
to be the set of models where $\phi$ holds.
Consider
\[
F = \{ H_\phi : \phi \in \Phi\}
\]
Then $F$ is a filter on $\finof(\Phi)$. By the \nameref{lem:ultra}, $F$ is contained in some ultrafilter $U$. Hence
we have chosen a $U$ such that, for each $\phi \in \Phi$, the set $\{f\in \finof(\Phi): M_f\models \phi\}$ is in $U$. Then
\[
\prod_{F\in\finof(\Phi)} M_F/U \models \Phi
\]
\end{proof}
\begin{cor}
  The \nameref{lem:ultra} implies the \nameref{th:compactness}. 
\end{cor}
The converse is also true: 
\begin{theorem}
  The \nameref{th:compactness} implies the \nameref{lem:ultra}. 
\end{theorem}
\begin{proof}
  \newcommand{\setth}{\texttt{set}}
  Let $S$ be a set. Suppose $F$ is a filter on $S$. Then the theory
  \begin{align*}
    \Phi = \setth \cup &\bigl\{ \\
                          &S\in F \\
                          &\forall A,B (A\in F \wedge B \in S \implies A \cup B \in F ) \\
                          &\varnothing \notin F \\
                          &\forall A,B (A\in F \wedge A \subseteq B \implies B \in F ) \\
                     &\bigr\}
                          &\cup \{x_f\in F: f\in F\}
  \end{align*}
  where $x_f$ is a constant symbol naming $f$ for each $f\in F$,
  has a model $M$. And $F\subseteq F|_M$. 
  
  I claim there is a model of $\Phi$ such that $F|_M$ is an ultrafilter.  Consider the theory
  \begin{align*}
    \Phi' = \Phi &\cup \{y_s \subseteq S: s\subseteq S\}\\
                 &\cup \{y_s\in F \vee S-x_s \in F : s \subseteq S\}
  \end{align*}
  where $y_s$ is a constant symbol naming $s$ for each $s\subseteq S$. 
  
  By the \nameref{th:compactness}, $\Phi'$ has a model. Call it $M'$.  Then
  \[
  \{f\cap S:f\in F|_{M'}\} -\varnothing
  \]
  is an ultrafilter containing $F$. 
\end{proof}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
